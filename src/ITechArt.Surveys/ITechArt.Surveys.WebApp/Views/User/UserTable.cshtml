@using Microsoft.AspNetCore.Http

@inject IHttpContextAccessor _contextAccessor

@model UserTableViewModel

@{
    ViewData["Title"] = "Users";
}

<link rel="stylesheet" href="~/css/userTable.css"/>

<h1>@ViewData["Title"]</h1>

<div class="user-table">
    <div class="table-header align-left">
        <strong>Name</strong>
    </div>
    <div class="table-header">
        <strong>Role</strong>
    </div>
    <div class="table-header">
        <strong>Registrated</strong>
    </div>
    <div class="table-header">
        <strong>Actions</strong>
    </div>
    @{
        var currentUserName = _contextAccessor.HttpContext?.User.Identity?.Name;
        foreach (var user in Model.Users)
        {
            <div class="align-left">@user.Name</div>
            <div>@string.Join(", ", user.Roles.Select(r => r.Name))</div>
            <div>@user.RegistrationDate.Date.ToShortDateString()</div>
            if (user.Name == currentUserName)
            {
                <div>
                    <span class="material-icons-outlined inactive-icon">delete</span>
                    <span class="material-icons-outlined inactive-icon">person_outline</span>
                </div>
            }
            else
            {
                <div>
                    <span>
                        @using (Html.BeginForm("DeleteUser", "User", FormMethod.Post))
                        {
                            @Html.Hidden("userId", user.Id)
                            <label class="delete-button">
                                <input type="submit" class="hide"/>
                                <span class="material-icons-outlined">delete</span>
                            </label>
                        }
                    </span>
                    @if (user.Roles.Any(r => r.Name == "Admin"))
                    {
                        <a href="/User/RevokeAdminRights?userId=@user.Id">
                            <span class="material-icons-outlined" title="Revoke admin rights">person_outline</span>
                        </a>
                    }
                    else
                    {
                        <a href="/User/GiveAdminRights?userId=@user.Id">
                            <span class="material-icons-outlined" title="Give admin rights">manage_accounts</span>
                        </a>
                    }
                </div>
            }
        }
    }
</div>

<div class="navbar-for-table">
    <div class="users-counter">
        Total users: @Model.TotalUsersAmount
    </div>
    <div class="flip-pages-arrows">
        @if (Model.Page != 1)
        {
            <a href="/User/UserTable?page=1">
                <span class="material-icons-outlined">keyboard_double_arrow_left</span>
            </a>
            <a href="/User/UserTable?page=@(Model.Page - 1)">
                <span class="material-icons-outlined">keyboard_arrow_left</span>
            </a>
        }
        <span>@Model.Page</span>
        @{
            const int usersPerPage = 5;
            if (Model.Page != Model.TotalUsersAmount / usersPerPage + 1)
            {
                <a href="/User/UserTable?page=@(Model.Page + 1)">
                    <span class="material-icons-outlined">keyboard_arrow_right</span>
                </a>
                <a href="/User/UserTable?page=@(Model.TotalUsersAmount / usersPerPage + 1)">
                    <span class="material-icons-outlined">keyboard_double_arrow_right</span>
                </a>
            }
        }
    </div>
</div>
